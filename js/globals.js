const cityList = ["new-york-city", "san-francisco", "paris", "berlin"];

var RegressorColumns = ["accommodates", "bathrooms", "bedrooms"];

var featureDict = {
  accommodates: 4,
  bathrooms: 1,
  bedrooms: 1
};

var selectedCity = 'new-york-city';

var curCurrency= "$";

// var cityBounds = {};
// var cityHotSpots = {};

var cityBounds = {"new-york-city":{"minLat":40.56251,"maxLat":40.9026,"minLon":-74.14781,"maxLon":-73.72910709,"centerLat":40.73002123832882,"centerLon":-73.96227055646322},"san-francisco":{"minLat":37.70839705,"maxLat":37.80756132,"minLon":-122.50963522,"maxLon":-122.3842624,"centerLat":37.76932720462687,"centerLon":-122.43170782290072},"paris":{"minLat":48.8165,"maxLat":48.90157428,"minLon":2.22793,"maxLon":2.45170517,"centerLat":48.86421037433465,"centerLon":2.345540990318692},"berlin":{"minLat":52.37843,"maxLat":52.63429,"minLon":13.1214,"maxLon":13.72102,"centerLat":52.51228005183943,"centerLon":13.40618911045655}};
var cityHotSpots = {"new-york-city":[[40.737209283464225,-73.98962831700376,1.9537251243814542],[40.78524367349419,-73.95774326358355,2.0389544160403097],[40.6958501810582,-73.80528749084657,1.7991738592476734],[40.81257169213693,-73.94544754537344,1.8250669137914346],[40.68460856537918,-73.93592776375321,1.7731219211065046],[40.676652847492626,-73.97530140618485,1.9586584246038685],[40.735455518225805,-73.98928574983383,2.163303260444918],[40.711664924143356,-73.94876575431819,1.9808876051489097],[40.76511563051802,-73.90557497970721,1.7811252429362192],[40.649578470221606,-73.99878413365651,1.7678530298241701]],"san-francisco":[[37.76795969537415,-122.48618057292516,1.9665676382382167],[37.728560057301586,-122.45289243761904,1.9075733277384346],[37.79388919300518,-122.41692858891192,1.9953623694373024],[37.76569692168831,-122.43601808467533,2.2059502356397953],[37.74934479508333,-122.41629291745834,1.935123709500932],[37.7717105561157,-122.44097003371901,1.9939505527243784],[37.76360159082353,-122.4124063910196,2.13043120681977],[37.79607146635294,-122.42520537658824,2.2135516363265237]],"paris":[[48.871687441551934,2.370831670287839,1.6325099701122756],[48.858299690632855,2.3535917451245867,1.905912445956659],[48.88039728140798,2.3409915163057327,1.8073275670180697],[48.836269426927736,2.3401196342983686,1.6671160512988852],[48.846485072803326,2.292682936037182,1.692428902489436],[48.88755932792453,2.3364207468932987,1.600016933771727],[48.86465449025378,2.2951560007069487,1.9064031691361394],[48.85241284255899,2.3873300549471117,1.6458139560144673]],"berlin":[[52.54531088030012,13.400273012448979,1.5157117145311871],[52.49672700355531,13.419342540395034,1.736021203893357],[52.51044922884381,13.475486503123733,1.5410414411666877],[52.481684192880216,13.427571746702558,1.5049251535451031],[52.49530159447094,13.320400688196722,1.5759906415973532],[52.53573069557269,13.407056168535242,1.7448598624659826]]};

// var jsonLearners = {};  // see: global_learners.js

var missingJson = (
  Object.keys(jsonLearners).length == 0
);

var curLearners = {};

if ( !missingJson ) {
  Object.keys(jsonLearners).forEach(function (curIndex) {
    curLearners[curIndex] = ML.RandomForestRegression.load(
      jsonLearners[curIndex]
    );
  });
}

// var cityErrorSpots = {};

var cityErrorSpots = {"new-york-city":[[40.697497256360656,-73.95426734806557,0.24499017791748123],[40.69587824042424,-73.95437023584849,-0.19323387260825364],[40.79010537678161,-73.95280865091954,0.2866652505959423],[40.73717726172973,-73.99138262951351,0.14229772367829913],[40.66330385786096,-73.98795367385027,-0.020007268373160976],[40.73807612048,-73.98894835850666,-0.28970628989851804],[40.80505928519855,-73.94926730158845,-0.15951683446203271],[40.694396311388886,-73.80297316083333,0.09658948848440353],[40.6833959748503,-73.9155575566467,-0.0767725157436715],[40.777664597765956,-73.89474026829787,-0.05352113531305616]],"san-francisco":[[37.7266094465,-122.4518189595,-0.021594363788266478],[37.7967504,-122.42106273534884,-0.111569574574203],[37.77835359,-122.4022802196875,0.09284596470325474],[37.771895829,-122.4381147136,-0.22285593297631737],[37.79461743344827,-122.42868725551725,0.3275272877816259],[37.772819395,-122.45882268375,0.04977948087971584],[37.767193584736845,-122.43223488894736,0.1366483444109902],[37.750691744307694,-122.41795942138462,-0.07852158069374784],[37.752303514761905,-122.421102135,0.29673762149740035],[37.76861256142857,-122.49057375321428,-0.11248668326202443]],"paris":[[48.83735855038518,2.33769977882963,-0.03113739120017963],[48.88553932241295,2.3392997629959513,-0.050301948659319896],[48.86028061204787,2.3794676350177304,0.014709323517666071],[48.853532224155124,2.2914778953462607,-0.007782091983338851],[48.866962670393015,2.348288193558952,0.3740001692741717],[48.86487486837209,2.3586404280066446,-0.3093517354103042]],"berlin":[[52.44101886678571,13.521102299642857,-0.032339383412519886],[52.54157864202952,13.404811191697418,-0.1592315804538639],[52.49677133733696,13.435337171847825,-0.3438490228930834],[52.49437383854251,13.434382541862348,0.1827252379604558],[52.49280319497268,13.325954348743169,-0.0002476522179749967],[52.53078908899471,13.403741105767196,0.4088998486064318]]};

var jsonRegressors = {"new-york-city":{"type":"Regression:RidgeRegression","algorithm":"RidgeRegression","userParameters":{"lambda":33.333333333333336},"lambda":33.333333333333336,"affine":true,"parameterGrid":{"lambda":[0.01,0.1,1,5,10]},"w":{"0":0.03723022538147577,"1":0.018801056326728606,"2":0.028521305204310524,"3":0.0481316884919373,"4":-0.006431074632259505,"5":-0.04867500760041757,"6":-0.017119693516522053,"7":-0.017289518220847615,"8":-0.02637742322192978,"9":0.0017974802724441182,"10":0.03991526367739832,"11":0.005812638666570915,"12":0.006482408308945451,"13":0.020369546394340663,"14":0.0046564116554123226,"15":0.021662918378022138,"16":0.029278184705434526,"17":-0.016495646604876242,"18":0.005356799200339861,"19":-0.0016060256125845144,"20":-0.03320413878952069,"21":0.009871508068748192,"22":0.008177077634655023,"23":-0.01506457923733068},"b":2.2123660498245643},"san-francisco":{"type":"Regression:RidgeRegression","algorithm":"RidgeRegression","userParameters":{"lambda":0.1},"lambda":0.1,"affine":true,"parameterGrid":{"lambda":[0.01,0.1,1,5,10]},"w":{"0":0.022333857643850194,"1":0.027375778018956836,"2":0.04248400643546287,"3":0.03097586474568439,"4":0.05279842996868733,"5":-0.037487501407069024,"6":0.0089685915778949,"7":0.02791357428456021,"8":0.03543403174527469,"9":0.059570239011934686,"10":-0.003705688816017006,"11":-0.007945626734104524,"12":-0.03434870448464991,"13":-0.01538558777828702,"14":-0.027087329846969863,"15":0.01987584584491784,"16":-0.04375799815235812,"17":-0.053267156166504,"18":-0.017671849350957752,"19":0.020978035801777067,"20":-0.013014633793502112,"21":0.016304837968431976},"b":2.318703764729509},"paris":{"type":"Regression:RidgeRegression","algorithm":"RidgeRegression","userParameters":{"lambda":0.6666666666666666},"lambda":0.6666666666666666,"affine":true,"parameterGrid":{"lambda":[0.01,0.1,1,5,10]},"w":{"0":0.05009237811248609,"1":0.018394686959834886,"2":0.04023326259796174,"3":0.046182843472300124,"4":-0.022574568581779916,"5":-0.02912489230465367,"6":0.00009246106016144007,"7":0.0067222732585904285,"8":-0.01752876486497444,"9":-0.004029237782381349,"10":0.0046947737630828,"11":0.009085063939088953,"12":0.0008507257158604264,"13":0.003367720015291233,"14":-0.015858643979900243,"15":0.012641857300803338,"16":-0.001957339630552389,"17":-0.012016334869322284},"b":1.981114324013989},"berlin":{"type":"Regression:RidgeRegression","algorithm":"RidgeRegression","userParameters":{"lambda":0.06666666666666667},"lambda":0.06666666666666667,"affine":true,"parameterGrid":{"lambda":[0.01,0.1,1,5,10]},"w":{"0":0.0495824633264501,"1":0.019749267025713217,"2":0.020225993594120972,"3":0.030930547788630355,"4":-0.03570313789319138,"5":-0.0052688098925890115,"6":0.022980917296285444,"7":-0.006684692434118876,"8":-0.027045929235948965,"9":0.015562382349357164,"10":-0.009354991455731182,"11":0.03349481430954642,"12":-0.0535241233657616,"13":0.048933425321504076,"14":0.002764110012287054,"15":-0.035740182356675344},"b":1.852833445005615}};
var jsonScalers = {"new-york-city":{"means":[3.747079166277222,1.0772969436395925,1.4243387232451632,2.220418710035663,0.4184863150579369,0.5968601489190141,0.46128863967457007,0.5695149197434745,0.42372326308244607,0.7153098296925832,0.9547617298312379,0.6764483651099352,0.5597814645144843,0.7538243969047791,0.42508840478776916,0.6194580667037239,0.49244349257881564,0.4961519413280693,0.6780871726288552,0.4266288328681322,0.9610150967831332,0.6340624354687069,0.7392263401524236,0.6607002799633181],"stdDevs":[1.5885879066343294,0.2631075752420554,0.6220463726324988,0.09520982237721075,0.34381591080462137,0.2939911340743316,0.30781199439459606,0.3155644520596475,0.33909339647474324,0.3231133296706337,0.10813162719479436,0.18779301436436133,0.32133161333654303,0.22568884131205733,0.3359114585424443,0.29959328199427093,0.28765740920209865,0.2922116200953027,0.32820371788527947,0.3413490114135319,0.10793431895318505,0.27812975506932264,0.1688959319558949,0.28545940415634696]},"san-francisco":{"means":[3.646982478909799,1.1982478909798833,1.5327709279688515,2.312146951302251,0.2930912046023011,0.1720915195392601,0.225823440550078,0.2842221718684294,0.18786016904388808,0.4966392851433245,0.2681799768173989,0.5056270997251577,0.28626845668437945,0.23024495420314817,0.17238144523463073,0.15846111418370104,0.5220289938187995,0.3008224483017577,0.30017508354577327,0.250215907987913,0.3165439247854501,0.5168216532342039],"stdDevs":[1.5327503648218974,0.39860574319766606,0.6816686307636918,0.09714001106594577,0.3055343063584706,0.2753390457287473,0.2544543011880289,0.3186847180766545,0.27507315474106964,0.1955386543330873,0.2980952362815114,0.18253503792085232,0.289193576772595,0.2980345647066258,0.28747293019951714,0.28121358685662873,0.1962409392262326,0.3114886767930965,0.25452358872881564,0.30310128456977625,0.21653420162341394,0.18127994330160602]},"paris":{"means":[3.365824047175129,1.083358626371244,1.2994840220266228,1.9811015189941588,0.4070749183900287,0.17885024216040368,0.21699709204685527,0.43948710703771743,0.3682416867014476,0.33198031016099183,0.21081287843900212,0.27192315228802333,0.1593796099407626,0.1547848468198906,0.2478628999743564,0.36155852030795604,0.2519435458720796,0.42897281050426006],"stdDevs":[1.3163702896541811,0.2609573444398589,0.5603181766678478,0.08644395967656804,0.20965877061075494,0.2764299171112397,0.28826904314379964,0.2526411855925232,0.21132473473996244,0.276495530681296,0.2947620269347888,0.30800871080698905,0.2834117633589546,0.30131116186642143,0.3125800910261115,0.2112449525385125,0.2924643246890149,0.23897205320831685]},"berlin":{"means":[3.2595941773268637,1.0598808998676665,1.3628142920158801,1.8533158237022695,0.3432107908791698,0.35620617872160143,0.6013428496732356,0.49249190294230494,0.4139390776251844,0.42235152467856224,0.33502785720613504,0.3700184112003645,0.3723495419219209,0.37931651413734635,0.8438919088202649,0.5896260053125435],"stdDevs":[1.37990507713502,0.22229194184496995,0.5907908771276343,0.07049101760004682,0.3492048125561837,0.301323765202952,0.2413632238636398,0.28220807046104507,0.31462955210726656,0.33140622387948965,0.3335370336040133,0.3111503638327073,0.32066788499615645,0.33442843110731085,0.13043183889555385,0.23951667566705165]}};

var curRegressors = {};
var curScalers = {};

var missingJson = (
  ( Object.keys(jsonRegressors).length == 0 ) ||
  ( Object.keys(jsonScalers).length == 0 )
);

if ( !missingJson ) {
  Object.keys(jsonScalers).forEach(function (curIndex) {
    curScalers[curIndex] = StandardScaler(
      jsonScalers[curIndex].means, jsonScalers[curIndex].stdDevs
    )
  });

  Object.keys(jsonRegressors).forEach(function (curIndex) {
    workRegressor = RidgeRegression()

    Object.keys(jsonRegressors[curIndex]).forEach(function (curKey) {
      workRegressor[curKey] = jsonRegressors[curIndex][curKey];
    })

    console.log(Object.values(workRegressor.w).length)
    workRegressor.predict = function (X) {
      return add(
        mul(
          X, Object.values(this.w)
        ), this.b
      );
    }

    curRegressors[curIndex] = workRegressor;
  });
}

var runTestScore = false;

